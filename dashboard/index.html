<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRENCHER ‚Äî Solana Gem Scanner</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@300;400;500;700&family=Barlow+Condensed:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --black: #03080f;
  --dark: #060e18;
  --panel: #080f1a;
  --surface: #0a1625;
  --line: rgba(0,180,255,0.1);
  --line-bright: rgba(0,180,255,0.35);
  --cyan: #00b4ff;
  --cyan-glow: 0 0 12px rgba(0,180,255,0.5);
  --orange: #ff5500;
  --orange-glow: 0 0 12px rgba(255,85,0,0.6);
  --yellow: #ffc200;
  --green: #00e676;
  --red: #ff1744;
  --purple: #b388ff;
  --text: #8ab4d4;
  --text-bright: #c8e0f0;
  --text-dim: #3a5a7a;
  --font-head: 'Bebas Neue', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --font-body: 'Barlow Condensed', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { cursor: none; }

body {
  background: var(--black);
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 12px;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* ‚îÄ‚îÄ CROSSHAIR CURSOR ‚îÄ‚îÄ */
#xhair {
  position: fixed;
  pointer-events: none;
  z-index: 9999;
  width: 32px; height: 32px;
  transform: translate(-50%, -50%);
}
#xhair::before, #xhair::after {
  content: '';
  position: absolute;
  background: var(--cyan);
  opacity: 0.8;
  transition: opacity 0.15s;
}
#xhair::before { /* horizontal */ width: 100%; height: 1px; top: 50%; left: 0; }
#xhair::after  { /* vertical */   width: 1px; height: 100%; left: 50%; top: 0; }
#xhair-dot {
  position: fixed;
  width: 3px; height: 3px;
  background: var(--cyan);
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%, -50%);
  box-shadow: var(--cyan-glow);
}
/* Corner ticks */
#xhair-tl, #xhair-tr, #xhair-bl, #xhair-br {
  position: fixed;
  pointer-events: none;
  z-index: 9998;
  width: 10px; height: 10px;
  border-color: var(--cyan);
  border-style: solid;
  opacity: 0.5;
  transform: translate(-50%, -50%);
}
#xhair-tl { border-width: 1px 0 0 1px; }
#xhair-tr { border-width: 1px 1px 0 0; }
#xhair-bl { border-width: 0 0 1px 1px; }
#xhair-br { border-width: 0 1px 1px 0; }

/* ‚îÄ‚îÄ GRID BACKGROUND ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(var(--line) 1px, transparent 1px),
    linear-gradient(90deg, var(--line) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ SCAN LINE ‚îÄ‚îÄ */
body::after {
  content: '';
  position: fixed;
  left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(0,180,255,0.3), transparent);
  animation: scanLine 6s linear infinite;
  pointer-events: none;
  z-index: 1;
}
@keyframes scanLine { 0%{top:-2px} 100%{top:100vh} }

/* ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ */
#bg-canvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  opacity: 0.4;
}

/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
#app {
  position: relative;
  z-index: 2;
  display: grid;
  grid-template-rows: 48px auto 1fr;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  padding: 0 20px;
  border-bottom: 1px solid var(--line-bright);
  background: rgba(3,8,15,0.95);
  backdrop-filter: blur(10px);
  gap: 20px;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}
.logo-icon {
  width: 28px; height: 28px;
  border: 1px solid var(--cyan);
  display: flex; align-items: center; justify-content: center;
  position: relative;
  flex-shrink: 0;
}
.logo-icon::before {
  content: '';
  position: absolute;
  inset: 3px;
  border: 1px solid rgba(0,180,255,0.3);
  animation: iconPulse 3s ease-in-out infinite;
}
@keyframes iconPulse { 0%,100%{opacity:0.3} 50%{opacity:1} }
.logo-icon span { font-size: 10px; color: var(--cyan); }
.logo-name {
  font-family: var(--font-head);
  font-size: 26px;
  letter-spacing: 4px;
  color: #fff;
  line-height: 1;
}
.logo-tag {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 3px;
  font-family: var(--font-body);
}

/* ticker tape in middle */
.ticker-wrap {
  overflow: hidden;
  border-left: 1px solid var(--line);
  border-right: 1px solid var(--line);
  padding: 0 12px;
  height: 100%;
  display: flex;
  align-items: center;
}
.ticker {
  display: flex;
  gap: 32px;
  white-space: nowrap;
  animation: tickerScroll 30s linear infinite;
  font-size: 11px;
  font-family: var(--font-body);
  font-weight: 600;
  letter-spacing: 1px;
}
@keyframes tickerScroll { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
.tick-item { display: flex; gap: 8px; align-items: center; }
.tick-sym { color: var(--text-bright); }
.tick-val { color: var(--text-dim); }
.tick-up { color: var(--green); }
.tick-dn { color: var(--red); }

.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
}
.live-pill {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 10px;
  font-family: var(--font-body);
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--green);
  border: 1px solid rgba(0,230,118,0.3);
  padding: 4px 10px;
}
.live-dot {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--green);
  animation: blink 1.5s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
#clock {
  font-family: var(--font-head);
  font-size: 16px;
  letter-spacing: 2px;
  color: var(--text-dim);
}
.tg-link {
  display: flex; align-items: center; gap: 6px;
  padding: 5px 14px;
  background: rgba(0,180,255,0.08);
  border: 1px solid var(--line-bright);
  color: var(--cyan);
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 11px;
  letter-spacing: 2px;
  text-decoration: none;
  transition: all 0.15s;
}
.tg-link:hover { background: rgba(0,180,255,0.18); box-shadow: var(--cyan-glow); }

/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  border-bottom: 1px solid var(--line-bright);
  background: rgba(6,14,24,0.98);
}
.stat {
  padding: 10px 16px;
  border-right: 1px solid var(--line);
  text-align: center;
  position: relative;
}
.stat:last-child { border-right: none; }
.stat-val {
  font-family: var(--font-head);
  font-size: 28px;
  line-height: 1;
  letter-spacing: 1px;
}
.stat-lbl {
  font-family: var(--font-body);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-dim);
  margin-top: 3px;
  font-weight: 600;
}

/* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
.main {
  display: grid;
  grid-template-columns: 1fr 320px;
  min-height: 0;
}

/* ‚îÄ‚îÄ LEFT: TWO ROWS ‚îÄ‚îÄ */
.left-col {
  display: grid;
  grid-template-rows: 1fr 220px;
  border-right: 1px solid var(--line-bright);
  min-height: 0;
}

/* ‚îÄ‚îÄ TOKEN FEED ‚îÄ‚îÄ */
.feed-panel {
  display: flex;
  flex-direction: column;
  border-bottom: 1px solid var(--line-bright);
  min-height: 0;
}

.panel-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(8,15,26,0.95);
  flex-shrink: 0;
}
.panel-label {
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 11px;
  letter-spacing: 3px;
  color: var(--cyan);
  display: flex;
  align-items: center;
  gap: 8px;
}
.panel-label::before {
  content: '';
  display: block;
  width: 8px; height: 8px;
  border: 1px solid var(--cyan);
  transform: rotate(45deg);
  box-shadow: var(--cyan-glow);
}

.filters {
  display: flex;
  gap: 3px;
}
.f-btn {
  padding: 3px 10px;
  background: none;
  border: 1px solid rgba(0,180,255,0.15);
  color: var(--text-dim);
  font-family: var(--font-head);
  font-size: 13px;
  letter-spacing: 1px;
  cursor: none;
  transition: all 0.15s;
}
.f-btn:hover { color: var(--text-bright); border-color: rgba(0,180,255,0.4); }
.f-btn.on-all { background: rgba(200,224,240,0.08); border-color: rgba(200,224,240,0.2); color: var(--text-bright); }
.f-btn.on-S { background: rgba(255,85,0,0.12); border-color: var(--orange); color: var(--orange); }
.f-btn.on-A { background: rgba(255,194,0,0.1); border-color: var(--yellow); color: var(--yellow); }
.f-btn.on-B { background: rgba(0,180,255,0.1); border-color: var(--cyan); color: var(--cyan); }

/* Table */
.thead {
  display: grid;
  grid-template-columns: 40px 200px 60px 100px 75px 90px 80px 60px;
  padding: 6px 16px;
  border-bottom: 1px solid var(--line);
  background: rgba(3,8,15,0.8);
  font-family: var(--font-body);
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-dim);
  font-weight: 700;
  flex-shrink: 0;
}
.th { display: flex; align-items: center; }
.th.r { justify-content: flex-end; }

.token-list {
  overflow-y: auto;
  flex: 1;
}
.token-list::-webkit-scrollbar { width: 2px; }
.token-list::-webkit-scrollbar-thumb { background: var(--line-bright); }

.trow {
  display: grid;
  grid-template-columns: 40px 200px 60px 100px 75px 90px 80px 60px;
  padding: 8px 16px;
  border-bottom: 1px solid rgba(0,180,255,0.04);
  cursor: none;
  transition: background 0.1s;
  position: relative;
  animation: rowSlide 0.35s ease both;
}
@keyframes rowSlide { from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)} }
.trow::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 2px;
  opacity: 0;
  transition: opacity 0.15s;
}
.trow.G-S::before { background: var(--orange); }
.trow.G-A::before { background: var(--yellow); }
.trow.G-B::before { background: var(--cyan); }
.trow.G-C::before { background: var(--text-dim); }
.trow:hover { background: rgba(0,180,255,0.03); }
.trow:hover::before { opacity: 1; }
.trow.flash { animation: flash 0.5s ease; }
@keyframes flash { 0%{background:rgba(255,85,0,0.12)} 100%{background:transparent} }

.td { display: flex; align-items: center; }
.td.r { justify-content: flex-end; }
.td.c { justify-content: center; }

/* Grade */
.grade {
  font-family: var(--font-head);
  font-size: 18px;
  width: 28px; height: 28px;
  display: flex; align-items: center; justify-content: center;
  border: 1px solid;
}
.G-S .grade { color: var(--orange); border-color: var(--orange); background: rgba(255,85,0,0.1); animation: gradeS 2s ease-in-out infinite; }
.G-A .grade { color: var(--yellow); border-color: var(--yellow); background: rgba(255,194,0,0.08); }
.G-B .grade { color: var(--cyan); border-color: rgba(0,180,255,0.4); background: rgba(0,180,255,0.06); }
.G-C .grade { color: var(--text-dim); border-color: rgba(58,90,122,0.4); }
@keyframes gradeS { 0%,100%{box-shadow:0 0 4px rgba(255,85,0,0.4)} 50%{box-shadow:0 0 14px rgba(255,85,0,0.8)} }

.tok-info { display: flex; flex-direction: column; gap: 3px; overflow: hidden; }
.tok-sym { font-family: var(--font-body); font-weight: 800; font-size: 14px; color: var(--text-bright); white-space: nowrap; }
.tok-flags { display: flex; gap: 3px; }
.flag {
  font-family: var(--font-body);
  font-size: 8px; font-weight: 700;
  padding: 1px 5px;
  letter-spacing: 0.5px;
  border: 1px solid;
}
.f-smart { color: var(--purple); border-color: rgba(179,136,255,0.3); background: rgba(179,136,255,0.06); }
.f-buy   { color: var(--green);  border-color: rgba(0,230,118,0.3);  background: rgba(0,230,118,0.05);  }
.f-surge { color: var(--orange); border-color: rgba(255,85,0,0.3);   background: rgba(255,85,0,0.05);   }
.f-safe  { color: var(--cyan);   border-color: rgba(0,180,255,0.3);  background: rgba(0,180,255,0.05);  }
.f-def   { color: var(--text-dim); border-color: rgba(58,90,122,0.3); }

.score-col { display: flex; flex-direction: column; align-items: flex-end; gap: 3px; }
.score-num { font-family: var(--font-head); font-size: 16px; }
.score-bar { width: 36px; height: 2px; background: rgba(200,224,240,0.08); }
.score-fill { height: 100%; transition: width 0.4s; }

.price-val { font-family: var(--font-mono); font-size: 11px; color: var(--text-bright); }
.chg { font-family: var(--font-body); font-weight: 700; font-size: 13px; }
.up { color: var(--green); }
.dn { color: var(--red); }
.neu { color: var(--text-dim); }

.liq-val, .age-val { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); }
.age-val.fresh { color: var(--orange); }

.bs { display: flex; align-items: center; gap: 4px; }
.bs-b { font-family: var(--font-body); font-weight: 700; font-size: 12px; color: var(--green); }
.bs-s { font-family: var(--font-body); font-weight: 700; font-size: 12px; color: var(--red); }

/* ‚îÄ‚îÄ CA SCANNER (bottom of left col) ‚îÄ‚îÄ */
.ca-panel {
  background: rgba(6,14,24,0.98);
  display: flex;
  flex-direction: column;
}
.ca-input-row {
  display: flex;
  gap: 0;
  flex-shrink: 0;
}
.ca-input {
  flex: 1;
  background: rgba(0,180,255,0.04);
  border: none;
  border-top: 1px solid var(--line);
  border-right: 1px solid var(--line);
  border-bottom: 1px solid var(--line);
  color: var(--text-bright);
  padding: 10px 14px;
  font-family: var(--font-mono);
  font-size: 12px;
  outline: none;
  transition: background 0.2s;
}
.ca-input::placeholder { color: var(--text-dim); }
.ca-input:focus { background: rgba(0,180,255,0.08); border-color: var(--cyan); }
.ca-btn {
  padding: 10px 20px;
  background: rgba(0,180,255,0.12);
  border: 1px solid var(--cyan);
  border-left: none;
  color: var(--cyan);
  font-family: var(--font-head);
  font-size: 16px;
  letter-spacing: 2px;
  cursor: none;
  transition: all 0.15s;
  white-space: nowrap;
}
.ca-btn:hover { background: rgba(0,180,255,0.25); box-shadow: var(--cyan-glow); }
.ca-btn:disabled { opacity: 0.4; cursor: not-allowed; }

.ca-result-area {
  flex: 1;
  overflow-y: auto;
  padding: 10px 16px;
}
.ca-result-area::-webkit-scrollbar { width: 2px; }
.ca-result-area::-webkit-scrollbar-thumb { background: var(--line-bright); }

.ca-idle {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 10px;
  color: var(--text-dim);
  font-family: var(--font-body);
  font-size: 11px;
  letter-spacing: 2px;
  font-weight: 600;
}
.ca-result-inner {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 12px;
  align-items: start;
}
.ca-grade-box {
  width: 56px; height: 56px;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-head);
  font-size: 32px;
  border: 1px solid;
}
.ca-grade-box.S { color: var(--orange); border-color: var(--orange); background: rgba(255,85,0,0.1); box-shadow: 0 0 16px rgba(255,85,0,0.3); }
.ca-grade-box.A { color: var(--yellow); border-color: var(--yellow); background: rgba(255,194,0,0.08); }
.ca-grade-box.B { color: var(--cyan); border-color: rgba(0,180,255,0.5); background: rgba(0,180,255,0.08); }
.ca-grade-box.C { color: var(--text-dim); border-color: var(--text-dim); }

.ca-token-info { min-width: 0; }
.ca-sym { font-family: var(--font-head); font-size: 22px; color: #fff; letter-spacing: 2px; }
.ca-name { font-family: var(--font-body); font-size: 11px; color: var(--text-dim); }
.ca-addr { font-size: 9px; color: var(--text-dim); word-break: break-all; margin-top:3px; }
.ca-score-big { text-align: right; }
.ca-score-num { font-family: var(--font-head); font-size: 36px; line-height: 1; }
.ca-score-sub { font-family: var(--font-body); font-size: 9px; letter-spacing: 2px; color: var(--text-dim); }

.ca-track { height: 3px; background: rgba(200,224,240,0.06); margin: 8px 0; }
.ca-fill { height: 100%; transition: width 0.8s cubic-bezier(0.34,1.56,0.64,1); }

.ca-mini-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 1px;
  background: var(--line);
  margin-top: 8px;
}
.ca-mini-stat {
  background: var(--panel);
  padding: 5px 8px;
}
.ca-mini-lbl { font-family: var(--font-body); font-size: 8px; letter-spacing: 1px; color: var(--text-dim); font-weight: 700; }
.ca-mini-val { font-family: var(--font-head); font-size: 14px; margin-top: 1px; }

.ca-flags-row { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
.ca-warn { color: var(--red); font-family: var(--font-body); font-size: 10px; font-weight: 700; margin-top: 4px; }

.ca-links { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.ca-lnk {
  font-family: var(--font-body);
  font-size: 10px; font-weight: 700;
  letter-spacing: 1px;
  color: var(--text-dim);
  text-decoration: none;
  border: 1px solid var(--line);
  padding: 3px 8px;
  transition: all 0.15s;
}
.ca-lnk:hover { color: var(--cyan); border-color: var(--cyan); }

.ca-spinning {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 10px;
}
.ca-spin {
  width: 20px; height: 20px;
  border: 2px solid var(--line);
  border-top-color: var(--cyan);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ RIGHT PANEL ‚Äî ALERTS ‚îÄ‚îÄ */
.alert-panel {
  display: flex;
  flex-direction: column;
  background: rgba(6,14,24,0.98);
}
.alert-list {
  flex: 1;
  overflow-y: auto;
}
.alert-list::-webkit-scrollbar { width: 2px; }
.alert-list::-webkit-scrollbar-thumb { background: var(--line-bright); }

.acard {
  padding: 12px 14px;
  border-bottom: 1px solid rgba(0,180,255,0.05);
  cursor: none;
  transition: background 0.1s;
  border-left: 2px solid transparent;
  animation: aslide 0.35s ease both;
}
@keyframes aslide { from{opacity:0;transform:translateX(8px)} to{opacity:1;transform:translateX(0)} }
.acard:hover { background: rgba(0,180,255,0.03); }
.acard.aS { border-left-color: var(--orange); }
.acard.aA { border-left-color: var(--yellow); }
.acard-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.acard-sym { font-family: var(--font-head); font-size: 16px; letter-spacing: 1px; color: #fff; }
.acard-badge {
  font-family: var(--font-head);
  font-size: 13px;
  padding: 2px 8px;
  border: 1px solid;
}
.acard-badge.S { color: var(--orange); border-color: var(--orange); background: rgba(255,85,0,0.1); }
.acard-badge.A { color: var(--yellow); border-color: var(--yellow); background: rgba(255,194,0,0.08); }
.acard-meta { font-family: var(--font-body); font-size: 10px; color: var(--text-dim); margin-bottom: 5px; display: flex; justify-content: space-between; }
.acard-score { font-family: var(--font-body); font-weight: 700; }
.acard-flags { display: flex; flex-wrap: wrap; gap: 3px; margin-bottom: 6px; }
.acard-bar { height: 2px; background: rgba(200,224,240,0.06); }
.acard-fill { height: 100%; }
.acard-links { display: flex; gap: 6px; margin-top: 6px; }
.acard-lnk {
  font-family: var(--font-body);
  font-size: 9px; font-weight: 700;
  color: var(--text-dim);
  text-decoration: none;
  border: 1px solid var(--line);
  padding: 2px 7px;
  transition: all 0.15s;
  letter-spacing: 1px;
}
.acard-lnk:hover { color: var(--cyan); border-color: var(--cyan); }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
#overlay {
  position: fixed; inset: 0;
  background: rgba(3,8,15,0.92);
  backdrop-filter: blur(6px);
  z-index: 500;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
#overlay.open { display: flex; }
#modal {
  background: var(--surface);
  border: 1px solid var(--line-bright);
  width: 100%; max-width: 560px;
  max-height: 88vh;
  overflow-y: auto;
  box-shadow: var(--cyan-glow), 0 20px 60px rgba(0,0,0,0.8);
  animation: mopen 0.25s ease;
}
#modal::-webkit-scrollbar { width: 2px; }
#modal::-webkit-scrollbar-thumb { background: var(--line); }
@keyframes mopen { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
.modal-hdr { padding: 18px 20px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: flex-start; }
.modal-close { background: none; border: none; color: var(--text-dim); font-size: 14px; cursor: none; font-family: var(--font-mono); transition: color 0.15s; }
.modal-close:hover { color: var(--red); }
.modal-body { padding: 16px 20px; }
.modal-stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1px; background: var(--line); }
.msstat { background: var(--panel); padding: 12px 14px; }
.msstat-l { font-family: var(--font-body); font-size: 9px; letter-spacing: 2px; color: var(--text-dim); font-weight: 700; margin-bottom: 4px; }
.msstat-v { font-family: var(--font-head); font-size: 18px; }
.modal-links { display: flex; gap: 8px; flex-wrap: wrap; padding: 12px 20px; border-top: 1px solid var(--line); }
.mlink {
  font-family: var(--font-body); font-weight: 700;
  font-size: 11px; letter-spacing: 1px;
  color: var(--text-dim);
  text-decoration: none;
  border: 1px solid var(--line);
  padding: 6px 14px;
  transition: all 0.15s;
}
.mlink:hover { color: var(--cyan); border-color: var(--cyan); background: rgba(0,180,255,0.06); }

/* ‚îÄ‚îÄ EMPTY STATES ‚îÄ‚îÄ */
.empty {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 40px 20px; gap: 10px;
  color: var(--text-dim);
  font-family: var(--font-body);
  font-size: 11px; font-weight: 600;
  letter-spacing: 2px; text-align: center;
}
.empty-ring {
  width: 40px; height: 40px;
  border: 1px solid var(--text-dim);
  border-radius: 50%;
  position: relative;
  animation: emptyPulse 2s ease-in-out infinite;
}
.empty-ring::after {
  content: '';
  position: absolute;
  inset: 6px;
  border: 1px solid var(--text-dim);
  border-radius: 50%;
  opacity: 0.4;
}
@keyframes emptyPulse { 0%,100%{opacity:0.3} 50%{opacity:0.8} }

/* ‚îÄ‚îÄ TOASTS ‚îÄ‚îÄ */
#toasts {
  position: fixed; top: 56px; right: 16px;
  z-index: 1000; display: flex;
  flex-direction: column; gap: 6px;
  pointer-events: none;
}
.toast {
  padding: 10px 16px;
  border: 1px solid;
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 12px;
  letter-spacing: 1px;
  max-width: 300px;
  animation: tin 0.25s ease, tout 0.25s ease 3.75s forwards;
}
.toast.S { background: rgba(255,85,0,0.12); border-color: var(--orange); color: var(--orange); }
.toast.A { background: rgba(255,194,0,0.08); border-color: var(--yellow); color: var(--yellow); }
@keyframes tin  { from{opacity:0;transform:translateX(14px)} to{opacity:1;transform:translateX(0)} }
@keyframes tout { from{opacity:1} to{opacity:0;transform:translateX(14px)} }
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>
<div id="xhair"></div>
<div id="xhair-dot"></div>
<div id="xhair-tl"></div><div id="xhair-tr"></div>
<div id="xhair-bl"></div><div id="xhair-br"></div>
<div id="toasts"></div>

<div id="app">

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon"><span>‚óà</span></div>
    <div>
      <div class="logo-name">TRENCHER</div>
      <div class="logo-tag">SOLANA GEM SCANNER</div>
    </div>
  </div>
  <div class="ticker-wrap">
    <div class="ticker" id="ticker">
      <span class="tick-item"><span class="tick-sym">SOL</span><span class="tick-val">LOADING...</span></span>
      <span class="tick-item"><span class="tick-sym">SOL</span><span class="tick-val">LOADING...</span></span>
    </div>
  </div>
  <div class="header-right">
    <div class="live-pill"><div class="live-dot"></div>LIVE</div>
    <div id="clock">--:--:--</div>
    <a href="https://t.me/trencheralertbot" target="_blank" class="tg-link">‚úà ALERTS</a>
  </div>
</header>

<!-- STATS -->
<div class="stats">
  <div class="stat"><div class="stat-val" id="s-total" style="color:var(--cyan)">0</div><div class="stat-lbl">SCANNED</div></div>
  <div class="stat"><div class="stat-val" id="s-grade-s" style="color:var(--orange)">0</div><div class="stat-lbl">GRADE S</div></div>
  <div class="stat"><div class="stat-val" id="s-grade-a" style="color:var(--yellow)">0</div><div class="stat-lbl">GRADE A</div></div>
  <div class="stat"><div class="stat-val" id="s-grade-b" style="color:var(--cyan)">0</div><div class="stat-lbl">GRADE B</div></div>
  <div class="stat"><div class="stat-val" id="s-avg" style="color:var(--green)">0</div><div class="stat-lbl">AVG SCORE</div></div>
  <div class="stat"><div class="stat-val" id="s-alerts" style="color:var(--purple)">0</div><div class="stat-lbl">ALERTS FIRED</div></div>
  <div class="stat"><div class="stat-val" style="color:var(--green);font-size:16px;padding-top:6px">‚óè ONLINE</div><div class="stat-lbl">STATUS</div></div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- LEFT COL -->
  <div class="left-col">

    <!-- TOKEN FEED -->
    <div class="feed-panel">
      <div class="panel-bar">
        <div class="panel-label">LIVE TOKEN FEED</div>
        <div class="filters">
          <button class="f-btn on-all" onclick="setFilter('ALL',this)">ALL</button>
          <button class="f-btn" onclick="setFilter('S',this)">S</button>
          <button class="f-btn" onclick="setFilter('A',this)">A</button>
          <button class="f-btn" onclick="setFilter('B',this)">B</button>
        </div>
      </div>
      <div class="thead">
        <div class="th">GRD</div>
        <div class="th">TOKEN</div>
        <div class="th r">SCR</div>
        <div class="th r">PRICE</div>
        <div class="th r">5M%</div>
        <div class="th r">LIQUIDITY</div>
        <div class="th r">B/S</div>
        <div class="th r">AGE</div>
      </div>
      <div class="token-list" id="token-list">
        <div class="empty"><div class="empty-ring"></div>SCANNING TRENCHES</div>
      </div>
    </div>

    <!-- CA SCANNER -->
    <div class="ca-panel">
      <div class="panel-bar">
        <div class="panel-label">CA SCANNER</div>
        <span style="font-family:var(--font-body);font-size:9px;letter-spacing:2px;color:var(--text-dim);font-weight:700;">LIVE DEXSCREENER DATA</span>
      </div>
      <div class="ca-input-row">
        <input class="ca-input" id="ca-in" type="text" placeholder="Paste any Solana contract address and press Enter..." onkeydown="if(event.key==='Enter')runCA()">
        <button class="ca-btn" id="ca-btn" onclick="runCA()">SCAN</button>
      </div>
      <div class="ca-result-area" id="ca-out">
        <div class="ca-idle">‚óà ENTER A CONTRACT ADDRESS TO ANALYZE</div>
      </div>
    </div>

  </div>

  <!-- RIGHT: ALERTS -->
  <div class="alert-panel">
    <div class="panel-bar">
      <div class="panel-label">ALERT HISTORY</div>
      <span style="font-family:var(--font-body);font-size:9px;letter-spacing:2px;color:var(--text-dim);font-weight:700;">S + A ONLY</span>
    </div>
    <div class="alert-list" id="alert-list">
      <div class="empty"><div class="empty-ring"></div>AWAITING SIGNALS</div>
    </div>
  </div>

</div>
</div>

<!-- MODAL -->
<div id="overlay" onclick="closeModal(event)">
  <div id="modal">
    <button class="modal-close" onclick="closeModal()">‚úï ESC</button>
    <div id="modal-inner"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACKGROUND PARTICLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const canvas = document.getElementById('bg-canvas');
const ctx = canvas.getContext('2d');
let pts = [];
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  pts = Array.from({length:80},()=>({
    x: Math.random()*canvas.width, y: Math.random()*canvas.height,
    vx: (Math.random()-.5)*.2, vy: (Math.random()-.5)*.2,
    r: Math.random()*.8+.2, op: Math.random()*.4+.1
  }));
}
function drawParticles() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  pts.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,180,255,${p.op})`; ctx.fill();
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0)p.x=canvas.width; if(p.x>canvas.width)p.x=0;
    if(p.y<0)p.y=canvas.height; if(p.y>canvas.height)p.y=0;
  });
  // draw connections
  for(let i=0;i<pts.length;i++) for(let j=i+1;j<pts.length;j++){
    const dx=pts[i].x-pts[j].x, dy=pts[i].y-pts[j].y;
    const d=Math.sqrt(dx*dx+dy*dy);
    if(d<100){ ctx.beginPath(); ctx.moveTo(pts[i].x,pts[i].y); ctx.lineTo(pts[j].x,pts[j].y);
      ctx.strokeStyle=`rgba(0,180,255,${0.06*(1-d/100)})`; ctx.lineWidth=.5; ctx.stroke(); }
  }
  requestAnimationFrame(drawParticles);
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas(); drawParticles();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CROSSHAIR CURSOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const xh=document.getElementById('xhair');
const xd=document.getElementById('xhair-dot');
const xtl=document.getElementById('xhair-tl');
const xtr=document.getElementById('xhair-tr');
const xbl=document.getElementById('xhair-bl');
const xbr=document.getElementById('xhair-br');
const GAP=20;
let mx=0,my=0;
document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;});
function moveCursor(){
  const s=p=>{p.style.left=mx+'px';p.style.top=my+'px';};
  s(xh);s(xd);
  xtl.style.left=(mx-GAP)+'px'; xtl.style.top=(my-GAP)+'px';
  xtr.style.left=(mx+GAP)+'px'; xtr.style.top=(my-GAP)+'px';
  xbl.style.left=(mx-GAP)+'px'; xbl.style.top=(my+GAP)+'px';
  xbr.style.left=(mx+GAP)+'px'; xbr.style.top=(my+GAP)+'px';
  requestAnimationFrame(moveCursor);
}
moveCursor();
document.addEventListener('mousedown',()=>{xh.style.opacity='0.4';});
document.addEventListener('mouseup',()=>{xh.style.opacity='1';});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK + TICKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
setInterval(()=>{ document.getElementById('clock').textContent=new Date().toUTCString().slice(17,25)+' UTC'; },1000);

async function updateTicker(){
  try{
    const r=await fetch('https://api.dexscreener.com/latest/dex/tokens/So11111111111111111111111111111111111111112');
    const d=await r.json();
    const pair=d.pairs?.[0];
    if(!pair)return;
    const price=parseFloat(pair.priceUsd||0).toFixed(2);
    const chg=pair.priceChange?.h24||0;
    const cls=chg>=0?'tick-up':'tick-dn';
    const chgStr=(chg>=0?'+':'')+chg.toFixed(2)+'%';
    const items=`
      <span class="tick-item"><span class="tick-sym">SOL/USD</span><span class="tick-val">$${price}</span><span class="${cls}">${chgStr}</span></span>
      <span class="tick-item"><span class="tick-sym">VOL 24H</span><span class="tick-val">${fmtLarge(pair.volume?.h24)}</span></span>
      <span class="tick-item"><span class="tick-sym">LIQ</span><span class="tick-val">${fmtLarge(pair.liquidity?.usd)}</span></span>
      <span class="tick-item"><span class="tick-sym">PUMP.FUN</span><span class="tick-val">LIVE</span></span>
      <span class="tick-item"><span class="tick-sym">SOL/USD</span><span class="tick-val">$${price}</span><span class="${cls}">${chgStr}</span></span>
      <span class="tick-item"><span class="tick-sym">VOL 24H</span><span class="tick-val">${fmtLarge(pair.volume?.h24)}</span></span>
      <span class="tick-item"><span class="tick-sym">LIQ</span><span class="tick-val">${fmtLarge(pair.liquidity?.usd)}</span></span>
      <span class="tick-item"><span class="tick-sym">PUMP.FUN</span><span class="tick-val">LIVE</span></span>
    `;
    document.getElementById('ticker').innerHTML=items;
  }catch(e){}
}
updateTicker(); setInterval(updateTicker,30000);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SB_URL='https://wwlomifjbgblcvjhggdb.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3bG9taWZqYmdibGN2amhnZ2RiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExODQ0MzQsImV4cCI6MjA4Njc2MDQzNH0.2_w4SV9tJcF5XcSSunrqKiI0SgPcgjuKbtSvjPsR_Mg';
const sb=supabase.createClient(SB_URL,SB_KEY);
let tokens=[],alerts=[],filter='ALL';

async function loadData(){
  const[{data:t},{data:a}]=await Promise.all([
    sb.from('tokens').select('*').order('scored_at',{ascending:false}).limit(200),
    sb.from('alerts').select('*').order('alerted_at',{ascending:false}).limit(60)
  ]);
  if(t){tokens=t;renderTokens();updateStats();}
  if(a){alerts=a;renderAlerts();}
}

sb.channel('t-live')
  .on('postgres_changes',{event:'INSERT',schema:'public',table:'tokens'},({new:t})=>{
    tokens.unshift(t); if(tokens.length>200)tokens.pop();
    renderTokens(); updateStats(); fireToast(t);
  })
  .on('postgres_changes',{event:'UPDATE',schema:'public',table:'tokens'},({new:t})=>{
    const i=tokens.findIndex(x=>x.address===t.address);
    if(i>=0)tokens[i]=t; else tokens.unshift(t);
    renderTokens(); updateStats();
  })
  .on('postgres_changes',{event:'INSERT',schema:'public',table:'alerts'},({new:a})=>{
    alerts.unshift(a); renderAlerts();
  })
  .subscribe();

loadData();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER TOKENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setFilter(f,el){
  filter=f;
  document.querySelectorAll('.f-btn').forEach(b=>{
    b.className='f-btn';
  });
  const map={ALL:'on-all',S:'on-S',A:'on-A',B:'on-B'};
  el.classList.add(map[f]);
  renderTokens();
}

function renderTokens(){
  const list=document.getElementById('token-list');
  const data=filter==='ALL'?tokens:tokens.filter(t=>t.grade===filter);
  if(!data.length){
    list.innerHTML='<div class="empty"><div class="empty-ring"></div>SCANNING TRENCHES</div>';
    return;
  }
  list.innerHTML=data.map((t,i)=>`
    <div class="trow G-${t.grade}" onclick="openModal('${t.address}')" style="animation-delay:${Math.min(i*.015,.4)}s">
      <div class="td c"><div class="grade">${t.grade}</div></div>
      <div class="tok-info td">
        <div class="tok-sym">${esc(t.symbol||'???')}</div>
        <div class="tok-flags">${flagHtml(t.flags)}</div>
      </div>
      <div class="td r">
        <div class="score-col">
          <div class="score-num" style="color:${gc(t.grade)}">${t.score}</div>
          <div class="score-bar"><div class="score-fill" style="width:${t.score}%;background:${gc(t.grade)}"></div></div>
        </div>
      </div>
      <div class="td r"><span class="price-val">${fp(t.price_usd)}</span></div>
      <div class="td r"><span class="chg ${cc(t.price_change_5m)}">${fc(t.price_change_5m)}</span></div>
      <div class="td r"><span class="liq-val">${fmtLarge(t.liquidity_usd)}</span></div>
      <div class="td r"><div class="bs"><span class="bs-b">${t.buys_5m||0}</span><span style="color:var(--text-dim);font-size:9px">/</span><span class="bs-s">${t.sells_5m||0}</span></div></div>
      <div class="td r"><span class="age-val ${isFresh(t.pair_created_at)?'fresh':''}">${fmtAge(t.pair_created_at)}</span></div>
    </div>
  `).join('');
  document.querySelector('.stat-lbl')&&(document.querySelector('#token-list').parentElement.parentElement.parentElement.querySelector('footer')&&null);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALERTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAlerts(){
  const list=document.getElementById('alert-list');
  const data=alerts.filter(a=>a.grade==='S'||a.grade==='A');
  if(!data.length){
    list.innerHTML='<div class="empty"><div class="empty-ring"></div>AWAITING SIGNALS</div>';
    return;
  }
  list.innerHTML=data.map((a,i)=>`
    <div class="acard a${a.grade}" style="animation-delay:${Math.min(i*.02,.4)}s">
      <div class="acard-top">
        <span class="acard-sym">${esc(a.token_symbol||'???')}</span>
        <span class="acard-badge ${a.grade}">${a.grade}</span>
      </div>
      <div class="acard-meta">
        <span>${fmtAgo(a.alerted_at)}</span>
        <span class="acard-score" style="color:${gc(a.grade)}">${a.score}/100</span>
      </div>
      <div class="acard-flags">${flagHtml(a.flags,true)}</div>
      <div class="acard-bar"><div class="acard-fill" style="width:${a.score}%;background:${gc(a.grade)}"></div></div>
      <div class="acard-links">
        <a class="acard-lnk" href="https://pump.fun/${a.token_address}" target="_blank">PUMP</a>
        <a class="acard-lnk" href="https://dexscreener.com/solana/${a.token_address}" target="_blank">CHART</a>
        <a class="acard-lnk" href="https://solscan.io/token/${a.token_address}" target="_blank">SCAN</a>
      </div>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateStats(){
  const avg=tokens.length?Math.round(tokens.reduce((s,t)=>s+(t.score||0),0)/tokens.length):0;
  anim('s-total',tokens.length);
  anim('s-grade-s',tokens.filter(t=>t.grade==='S').length);
  anim('s-grade-a',tokens.filter(t=>t.grade==='A').length);
  anim('s-grade-b',tokens.filter(t=>t.grade==='B').length);
  anim('s-avg',avg);
  anim('s-alerts',alerts.length);
}
function anim(id,target){
  const el=document.getElementById(id);
  if(!el)return;
  const cur=parseInt(el.textContent)||0;
  if(cur===target)return;
  const step=(target-cur)/12; let v=cur;
  const t=()=>{ v+=step; el.textContent=Math.round(v); if(Math.abs(v-target)>.5)requestAnimationFrame(t); else el.textContent=target; };
  requestAnimationFrame(t);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(addr){
  const t=tokens.find(x=>x.address===addr); if(!t)return;
  const g=gc(t.grade);
  document.getElementById('modal-inner').innerHTML=`
    <div class="modal-hdr">
      <div>
        <div style="font-family:var(--font-head);font-size:26px;letter-spacing:2px;color:#fff;">${esc(t.symbol||'???')} <span style="font-size:14px;color:var(--text-dim)">${esc(t.name||'')}</span></div>
        <div style="font-size:10px;color:var(--text-dim);margin-top:4px;word-break:break-all">${t.address}</div>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center;">
          <div style="font-family:var(--font-head);font-size:22px;color:${g};border:1px solid ${g};padding:2px 10px;background:${g}15;">${t.grade}</div>
          <div style="font-family:var(--font-head);font-size:32px;color:${g}">${t.score}<span style="font-size:14px;color:var(--text-dim)">/100</span></div>
        </div>
        <div style="height:3px;background:rgba(200,224,240,0.06);margin-top:8px;"><div style="height:100%;width:0%;background:${g};transition:width .8s cubic-bezier(0.34,1.56,0.64,1)" id="msbar"></div></div>
        <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;">${flagHtml(t.flags,false,true)}</div>
      </div>
      <button class="modal-close" onclick="closeModal()">‚úï ESC</button>
    </div>
    <div class="modal-body">
      <div class="modal-stat-grid">
        ${[['PRICE',fp(t.price_usd),null],['5M%',fc(t.price_change_5m),fcc(t.price_change_5m)],['1H%',fc(t.price_change_1h),fcc(t.price_change_1h)],
           ['FDV',fmtLarge(t.fdv),null],['LIQUIDITY',fmtLarge(t.liquidity_usd),t.liquidity_usd>50000?'var(--green)':t.liquidity_usd<5000?'var(--red)':null],['VOL 1H',fmtLarge(t.volume_1h),null],
           ['BUYS 5M',t.buys_5m||0,'var(--green)'],['SELLS 5M',t.sells_5m||0,'var(--red)'],['BUY RATIO',((t.buy_ratio_5m||.5)*100).toFixed(0)+'%',null],
           ['HOLDERS',t.holder_count||'?',null],['TOP 10%',(t.top10_pct||0).toFixed(1)+'%',null],['SMART $',t.smart_money_count||0,t.smart_money_count>0?'var(--purple)':null]]
          .map(([l,v,c])=>`<div class="msstat"><div class="msstat-l">${l}</div><div class="msstat-v" style="color:${c||'var(--text-bright)'}">${v}</div></div>`).join('')}
      </div>
    </div>
    <div class="modal-links">
      <a class="mlink" href="https://pump.fun/${t.address}" target="_blank">PUMP.FUN</a>
      <a class="mlink" href="${t.dex_url||'https://dexscreener.com/solana/'+t.address}" target="_blank">DEXSCREENER</a>
      <a class="mlink" href="https://solscan.io/token/${t.address}" target="_blank">SOLSCAN</a>
      <a class="mlink" href="https://birdeye.so/token/${t.address}?chain=solana" target="_blank">BIRDEYE</a>
      <a class="mlink" href="https://rugcheck.xyz/tokens/${t.address}" target="_blank">RUGCHECK</a>
    </div>
  `;
  document.getElementById('overlay').classList.add('open');
  setTimeout(()=>{ const b=document.getElementById('msbar'); if(b)b.style.width=t.score+'%'; },100);
}
function closeModal(e){
  if(!e||e.target===document.getElementById('overlay')||e.currentTarget?.tagName==='BUTTON')
    document.getElementById('overlay').classList.remove('open');
}
document.addEventListener('keydown',e=>{ if(e.key==='Escape')closeModal(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CA SCANNER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function runCA(){
  const inp=document.getElementById('ca-in');
  const out=document.getElementById('ca-out');
  const btn=document.getElementById('ca-btn');
  const ca=inp.value.trim();
  if(!ca||ca.length<32){ out.innerHTML='<div class="ca-idle" style="color:var(--red)">‚ö† INVALID ADDRESS</div>'; return; }
  out.innerHTML='<div class="ca-spinning"><div class="ca-spin"></div><span style="font-family:var(--font-body);font-size:11px;letter-spacing:2px;color:var(--cyan)">SCANNING...</span></div>';
  btn.disabled=true; btn.textContent='...';
  try{
    const r=await fetch('https://api.dexscreener.com/latest/dex/tokens/'+ca);
    const d=await r.json();
    const pairs=d.pairs||[];
    if(!pairs.length){
      out.innerHTML=`<div class="ca-idle" style="flex-direction:column;gap:8px;">
        <span style="color:var(--red)">‚ö† NO PAIRS FOUND</span>
        <div style="display:flex;gap:8px;">
          <a class="ca-lnk" href="https://solscan.io/token/${ca}" target="_blank">SOLSCAN</a>
          <a class="ca-lnk" href="https://pump.fun/${ca}" target="_blank">PUMP.FUN</a>
        </div>
      </div>`;
      return;
    }
    const pair=pairs.find(p=>p.dexId==='pumpfun')||pairs.sort((a,b)=>(b.liquidity?.usd||0)-(a.liquidity?.usd||0))[0];
    const t={
      address:ca, name:pair.baseToken?.name||'Unknown', symbol:pair.baseToken?.symbol||'???',
      priceUsd:parseFloat(pair.priceUsd||0), priceChange5m:pair.priceChange?.m5||0,
      priceChange1h:pair.priceChange?.h1||0, priceChange6h:pair.priceChange?.h6||0,
      volume5m:pair.volume?.m5||0, volume1h:pair.volume?.h1||0, volume24h:pair.volume?.h24||0,
      liquidityUsd:pair.liquidity?.usd||0, fdv:pair.fdv||0, marketCap:pair.marketCap||0,
      buys5m:pair.txns?.m5?.buys||0, sells5m:pair.txns?.m5?.sells||0,
      buys1h:pair.txns?.h1?.buys||0, sells1h:pair.txns?.h1?.sells||0,
      buyRatio5m:(()=>{const tx=pair.txns?.m5;if(!tx)return .5;const tot=(tx.buys||0)+(tx.sells||0);return tot?tx.buys/tot:.5;})(),
      pairCreatedAt:pair.pairCreatedAt, imageUrl:pair.info?.imageUrl,
      socials:pair.info?.socials||[], websites:pair.info?.websites||[],
      dexUrl:pair.url, dexId:pair.dexId, pairCount:pairs.length,
    };
    const sr=scoreCA(t); renderCA(t,sr,pairs);
  }catch(e){
    out.innerHTML=`<div class="ca-idle" style="color:var(--red)">‚ö† ERROR: ${e.message}</div>`;
  }finally{ btn.disabled=false; btn.textContent='SCAN'; }
}

function scoreCA(t){
  let score=0;const flags=[];const warnings=[];
  if(t.liquidityUsd<3000)warnings.push('LOW LIQUIDITY');
  if(t.buyRatio5m<0.3)warnings.push('HEAVY SELLING');
  if(t.buyRatio5m>=.75){score+=18;flags.push('STRONG_BUY');}
  else if(t.buyRatio5m>=.6){score+=10;flags.push('MODERATE_BUY');}
  if(t.priceChange5m>=50){score+=12;flags.push('5M_EXPLOSION');}
  else if(t.priceChange5m>=20){score+=8;flags.push('5M_SURGE');}
  else if(t.priceChange5m>=5){score+=4;flags.push('5M_PUMP');}
  if(t.buys5m>=50){score+=10;flags.push('HIGH_ORGANIC_BUYS');}
  else if(t.buys5m>=20){score+=5;flags.push('ORGANIC_BUYS');}
  if(t.liquidityUsd>=50000){score+=12;flags.push('STRONG_LIQUIDITY');}
  else if(t.liquidityUsd>=15000){score+=6;flags.push('DECENT_LIQUIDITY');}
  else if(t.liquidityUsd>=5000){score+=2;flags.push('FAIR_LIQUIDITY');}
  const ageMin=t.pairCreatedAt?(Date.now()-t.pairCreatedAt)/60000:999;
  if(ageMin<=5){score+=10;flags.push('ULTRA_EARLY');}
  else if(ageMin<=15){score+=6;flags.push('EARLY_ENTRY');}
  else if(ageMin<=60){score+=2;flags.push('RECENT');}
  if(t.socials?.some(s=>s.type==='twitter')){score+=5;flags.push('HAS_TWITTER');}
  if(t.socials?.some(s=>s.type==='telegram')){score+=5;flags.push('HAS_TELEGRAM');}
  if(t.websites?.length>0){score+=5;flags.push('HAS_WEBSITE');}
  if(t.pairCount>3){score+=5;flags.push('MULTI_DEX');}
  score=Math.min(score,100);
  const grade=score>=80?'S':score>=60?'A':score>=40?'B':'C';
  return{score,grade,flags,warnings};
}

function renderCA(t,sr,pairs){
  const g=gc(sr.grade);
  const ageMin=t.pairCreatedAt?Math.round((Date.now()-t.pairCreatedAt)/60000):null;
  const ageStr=ageMin===null?'?':ageMin<60?ageMin+'m':Math.floor(ageMin/60)+'h '+(ageMin%60)+'m';
  document.getElementById('ca-out').innerHTML=`
    <div class="ca-result-inner" style="margin-bottom:10px;">
      <div class="ca-grade-box ${sr.grade}">${sr.grade}</div>
      <div class="ca-token-info">
        <div class="ca-sym">${esc(t.symbol)}</div>
        <div class="ca-name">${esc(t.name)} ¬∑ ${t.dexId?.toUpperCase()||'DEX'} ¬∑ ${t.pairCount} pair${t.pairCount!==1?'s':''} ¬∑ ${ageStr} old</div>
        <div class="ca-addr">${t.address}</div>
      </div>
      <div class="ca-score-big">
        <div class="ca-score-num" style="color:${g}">${sr.score}</div>
        <div class="ca-score-sub">/100 SCORE</div>
      </div>
    </div>
    <div class="ca-track"><div class="ca-fill" style="width:${sr.score}%;background:${g};box-shadow:0 0 8px ${g}60;"></div></div>
    ${sr.warnings.length?`<div style="display:flex;gap:8px;margin:6px 0;">${sr.warnings.map(w=>`<span class="ca-warn">‚ö† ${w}</span>`).join('')}</div>`:''}
    <div class="ca-flags-row">${flagHtml(sr.flags,false,true)}</div>
    <div class="ca-mini-grid">
      ${[['PRICE',fp(t.priceUsd),null],['5M%',fc(t.priceChange5m),fcc(t.priceChange5m)],['1H%',fc(t.priceChange1h),fcc(t.priceChange1h)],
         ['FDV',fmtLarge(t.fdv),null],['LIQ',fmtLarge(t.liquidityUsd),t.liquidityUsd>50000?'var(--green)':t.liquidityUsd<5000?'var(--red)':null],['MCAP',fmtLarge(t.marketCap),null],
         ['VOL5M',fmtLarge(t.volume5m),null],['VOL1H',fmtLarge(t.volume1h),null],['VOL24H',fmtLarge(t.volume24h),null],
         ['BUYS5M',t.buys5m,'var(--green)'],['SELLS5M',t.sells5m,'var(--red)'],['B/S%',((t.buyRatio5m||.5)*100).toFixed(0)+'%',t.buyRatio5m>.65?'var(--green)':t.buyRatio5m<.35?'var(--red)':null]]
        .map(([l,v,c])=>`<div class="ca-mini-stat"><div class="ca-mini-lbl">${l}</div><div class="ca-mini-val" style="color:${c||'var(--text-bright)'}">${v??'?'}</div></div>`).join('')}
    </div>
    <div class="ca-links" style="margin-top:8px;">
      <a class="ca-lnk" href="https://pump.fun/${t.address}" target="_blank">PUMP.FUN</a>
      <a class="ca-lnk" href="${t.dexUrl||'https://dexscreener.com/solana/'+t.address}" target="_blank">DEXSCREENER</a>
      <a class="ca-lnk" href="https://solscan.io/token/${t.address}" target="_blank">SOLSCAN</a>
      <a class="ca-lnk" href="https://birdeye.so/token/${t.address}?chain=solana" target="_blank">BIRDEYE</a>
      <a class="ca-lnk" href="https://rugcheck.xyz/tokens/${t.address}" target="_blank">RUGCHECK</a>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fireToast(t){
  if(t.grade!=='S'&&t.grade!=='A')return;
  const c=document.getElementById('toasts');
  const el=document.createElement('div');
  el.className=`toast ${t.grade}`;
  el.textContent=`${t.grade==='S'?'üî¥':'‚ö°'} [${t.grade}] ${esc(t.symbol||'???')} ‚Äî ${t.score}/100`;
  c.appendChild(el);
  setTimeout(()=>el.remove(),4100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gc(g){return{S:'var(--orange)',A:'var(--yellow)',B:'var(--cyan)',C:'var(--text-dim)'}[g]||'#888';}
function cc(v){return v>0?'up':v<0?'dn':'neu';}
function fcc(v){return v>0?'var(--green)':v<0?'var(--red)':'var(--text-dim)';}
function fc(v){if(!v)return '0.0%';return(v>0?'+':'')+Number(v).toFixed(1)+'%';}
function fp(p){
  if(!p)return '$0';
  if(p<.000001)return '$'+Number(p).toExponential(2);
  if(p<.001)return '$'+Number(p).toFixed(8);
  if(p<1)return '$'+Number(p).toFixed(6);
  return '$'+Number(p).toFixed(4);
}
function fmtLarge(n){
  if(!n)return '$0';
  if(n>=1e9)return '$'+(n/1e9).toFixed(1)+'B';
  if(n>=1e6)return '$'+(n/1e6).toFixed(1)+'M';
  if(n>=1e3)return '$'+(n/1e3).toFixed(1)+'K';
  return '$'+Math.round(n);
}
function fmtAge(ts){
  if(!ts)return '?';
  const m=Math.floor((Date.now()-new Date(ts))/60000);
  if(m<60)return m+'m'; if(m<1440)return Math.floor(m/60)+'h'; return Math.floor(m/1440)+'d';
}
function fmtAgo(ts){
  if(!ts)return '?';
  const m=Math.floor((Date.now()-new Date(ts))/60000);
  if(m<1)return 'just now'; if(m<60)return m+'m ago'; return Math.floor(m/60)+'h ago';
}
function isFresh(ts){return ts&&(Date.now()-new Date(ts))<600000;}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

const FMAP={SMART_MONEY:'f-smart',STRONG_BUY:'f-buy',MODERATE_BUY:'f-buy',ORGANIC_BUYS:'f-buy',HIGH_ORGANIC_BUYS:'f-buy',
  EXPLOSION:'f-surge','5M_EXPLOSION':'f-surge','5M_SURGE':'f-surge',SURGE:'f-surge',PUMP:'f-surge',ULTRA_EARLY:'f-surge',
  STRONG_LIQUIDITY:'f-safe',DECENT_LIQUIDITY:'f-safe',HAS_TWITTER:'f-safe',HAS_TELEGRAM:'f-safe',HAS_WEBSITE:'f-safe'};
function getFC(f){for(const[k,v]of Object.entries(FMAP)){if(f.includes(k))return v;}return 'f-def';}
function flagHtml(flags,small=false,large=false){
  if(!flags?.length)return '';
  return(flags||[]).slice(0,large?8:small?3:4).map(f=>`<span class="flag ${getFC(f)}" style="${large?'font-size:9px;padding:2px 7px':''}">${f.replace(/_/g,' ')}</span>`).join('');
}
</script>
</body>
</html>
